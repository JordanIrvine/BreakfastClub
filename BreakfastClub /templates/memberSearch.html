{% extends 'layout.html' %}

<html>
{% block body %}
<script>
$(document).ready(function(){
    $('.search').on('keyup',function(){
        var searchTerm = $(this).val().toLowerCase();
        $('#myTable tbody tr').each(function(){
            var lineStr = $(this).text().toLowerCase();
            if(lineStr.indexOf(searchTerm) === -1){
                $(this).hide();
            }else{
                $(this).show();
                //disable the enter button in the search bar: https://stackoverflow.com/questions/5629805/disabling-enter-key-for-form
                $(document).keypress(function(event){
                    if (event.which == '13') {
                      event.preventDefault();
                    }
                  });
            }
        });
    });
});

</script>
<bold><center><h3><form action="/search" method=post>
    <div><input input type=text class="search" placeholder="Type to Search..." pull-center></input>
</form></h3></center></bold>
<title>HELLO</title>
  <a href="add_member" class="btn btn-default">Add Member</a>
  <hr>
  <table class="table table-striped" id="myTable">
    <thead>
      <tr>
        <th>ClientID</th>
        <th>Name</th>
        <th></th>
        <th>Last Visit Date</th>
        <th>Total Visits</th>
        <th>Visits Til Free Breakfast </th>
        <th></th>
        <th></th>
        <th></th>
      </tr>
    </thead>
    {% for member in members %}
    <tbody>
      <tr>
        <td>{{member.clientId}}</td>
        <td><a href="/visitSearch/{{member.clientId}}">{{member.name}}</a><td>
        <td>{{member.lastBreakfastDate}}</td>
        <td>{{member.totalBreakfast}}</td>
        <td>{{member.leftTillFree}}</td>
        <td>

          <form action="{{url_for('add_visit', id=member.clientId, name=member.name)}}" method="post">
              <input type="submit" id="visit" class="btn btn-default" value="Add Visit"></input>
          </form>
        </td>
        <script>
        //temperarily disbale "add visit" button after pressed
        var fewSeconds = 5;
        $('#visit').click(function(){
            // Ajax request
            var btn = $(this);
            btn.prop('disabled', true);
            setTimeout(function(){
                btn.prop('disabled', false);
            }, fewSeconds*1000);
        });
        </script>
        <td>
          <form action="{{url_for('memberSearch')}}" method="post">
              <input class="btn btn-success" value="Redeem free breakfast" type="submit"></input>
          </form>
        </td>

        <td>
          <form action="{{url_for('delete_member', id=member.clientId)}}" method="post">
            <input type="hidden" name="_method" value="DELETE"></input>
            <input type="submit" onclick="return confirm('Are you sure you want to delete this member? All of this members information will be deleted as well!')" value="Delete" class="btn btn-danger"></input>
          </form>
        </td>
      </tr>
    </tbody>
    {% endfor %}
  </table>
{% endblock %}
</html>
